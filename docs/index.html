<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>scran_log_normalize_counts: Model per-gene variance in expression</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">scran_log_normalize_counts
   </div>
   <div id="projectbrief">Normalize and log-transform counts</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Model per-gene variance in expression </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a> <img src="https://github.com/libscran/log_normalize_counts/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/libscran/log_normalize_counts/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/libscran/log_normalize_counts"><img src="https://codecov.io/gh/libscran/log_normalize_counts/graph/badge.svg?token=JWV0I4WJX2" alt="Codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1>Overview</h1>
<p>This repository contains functions to perform scaling normalization and log-transformation of a gene-by-cell count matrix. Normalization removes per-cell scaling biases such as differences in capture efficiency and sequencing depth, while the log-transformation provides some variance stabilization and allows differences in values to be interpreted as log-fold changes. The code itself was originally derived from the <a href="https://bioconductor.org/packages/scran"><b>scran</b> R package</a>, factored out into a separate C++ library for easier re-use.</p>
<h1>Quick start</h1>
<p>Given a measure of the per-cell scaling bias - for example, the sum of counts for a cell - we can convert them into centered size factors:</p>
<div class="fragment"><div class="line"><span class="comment">// Assuming that counts is a std::shared_ptr&lt;tatami::Matrix&gt;</span></div>
<div class="line">std::vector&lt;double&gt; bias = tatami_stats::sums::by_column(counts.get()); </div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structscran_1_1center__size__factors_1_1Options.html">scran::center_size_factors::Options</a> copt;</div>
<div class="line"><a class="code hl_function" href="namespacescran_1_1center__size__factors.html#a6c791f5cf852c4901e510e90af0d3744">scran::center_size_factors::compute</a>(bias.size(), bias.data(), NULL, copt);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// &#39;bias&#39; is now centered at unity and can be used as size factors.</span></div>
<div class="line"><span class="keyword">auto</span>&amp; size_factors = bias;</div>
<div class="ttc" id="anamespacescran_1_1center__size__factors_html_a6c791f5cf852c4901e510e90af0d3744"><div class="ttname"><a href="namespacescran_1_1center__size__factors.html#a6c791f5cf852c4901e510e90af0d3744">scran::center_size_factors::compute</a></div><div class="ttdeci">SizeFactor_ compute(size_t num, SizeFactor_ *size_factors, sanitize_size_factors::Diagnostics *diagnostics, const Options &amp;options)</div><div class="ttdef"><b>Definition</b> center_size_factors.hpp:127</div></div>
<div class="ttc" id="astructscran_1_1center__size__factors_1_1Options_html"><div class="ttname"><a href="structscran_1_1center__size__factors_1_1Options.html">scran::center_size_factors::Options</a></div><div class="ttdoc">Options for compute() and compute_blocked().</div><div class="ttdef"><b>Definition</b> center_size_factors.hpp:42</div></div>
</div><!-- fragment --><p>Alternatively, in the presence of blocks, we adjust our centering so that the mean size factor in each block is no less than 1. This avoids inflated variances from applying small size factors to low-coverage blocks.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="namespacescran_1_1center__size__factors.html#a38aec96b210a32eb97ae5c0f47fe861c">scran::center_size_factors::compute_blocked</a>(</div>
<div class="line">    bias.size(), </div>
<div class="line">    bias.data(), </div>
<div class="line">    block.data(), </div>
<div class="line">    NULL, </div>
<div class="line">    copt</div>
<div class="line">);</div>
<div class="ttc" id="anamespacescran_1_1center__size__factors_html_a38aec96b210a32eb97ae5c0f47fe861c"><div class="ttname"><a href="namespacescran_1_1center__size__factors.html#a38aec96b210a32eb97ae5c0f47fe861c">scran::center_size_factors::compute_blocked</a></div><div class="ttdeci">std::vector&lt; SizeFactor_ &gt; compute_blocked(size_t num, SizeFactor_ *size_factors, const Block_ *block, sanitize_size_factors::Diagnostics *diagnostics, const Options &amp;options)</div><div class="ttdef"><b>Definition</b> center_size_factors.hpp:204</div></div>
</div><!-- fragment --><p>If our size factors might contain invalid values (i.e., zero, negative, or non-finite), we can sanitize them prior to the construction of the log-normalized matrix:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structscran_1_1sanitize__size__factors_1_1Options.html">scran::sanitize_size_factors::Options</a> sopt;</div>
<div class="line">opt.<a class="code hl_variable" href="structscran_1_1sanitize__size__factors_1_1Options.html#aea15dd95caf27c024bbc0afd8b44aa86">handle_zero</a> = scran::sanitize_size_factors::HandleAction::SANITIZE;</div>
<div class="line">opt.handle_infinite = scran::sanitize_size_factors::HandleAction::SANITIZE;</div>
<div class="line"><a class="code hl_function" href="namespacescran_1_1sanitize__size__factors.html#a5aed65fe52d5abe25550519137805be7">scran::sanitize_size_factors::compute</a>(size_factors.size(), size_factors.data(), sopt);</div>
<div class="line"><span class="comment">// Gets rid of any zero and infinite values in &#39;size_factors&#39;.</span></div>
<div class="ttc" id="anamespacescran_1_1sanitize__size__factors_html_a5aed65fe52d5abe25550519137805be7"><div class="ttname"><a href="namespacescran_1_1sanitize__size__factors.html#a5aed65fe52d5abe25550519137805be7">scran::sanitize_size_factors::compute</a></div><div class="ttdeci">void compute(size_t num, SizeFactor_ *size_factors, const Diagnostics &amp;status, const Options &amp;options)</div><div class="ttdef"><b>Definition</b> sanitize_size_factors.hpp:203</div></div>
<div class="ttc" id="astructscran_1_1sanitize__size__factors_1_1Options_html"><div class="ttname"><a href="structscran_1_1sanitize__size__factors_1_1Options.html">scran::sanitize_size_factors::Options</a></div><div class="ttdoc">Default parameters.</div><div class="ttdef"><b>Definition</b> sanitize_size_factors.hpp:157</div></div>
<div class="ttc" id="astructscran_1_1sanitize__size__factors_1_1Options_html_aea15dd95caf27c024bbc0afd8b44aa86"><div class="ttname"><a href="structscran_1_1sanitize__size__factors_1_1Options.html#aea15dd95caf27c024bbc0afd8b44aa86">scran::sanitize_size_factors::Options::handle_zero</a></div><div class="ttdeci">HandleAction handle_zero</div><div class="ttdef"><b>Definition</b> sanitize_size_factors.hpp:169</div></div>
</div><!-- fragment --><p>Finally, we convert our a <a href="https://github.com/tatami-inc/tatami"><code>tatami::Matrix</code></a> of counts to a log-transformed normalized matrix:</p>
<div class="fragment"><div class="line">scran::log_normalize_counts::Options lopts;</div>
<div class="line"><span class="keyword">auto</span> logcounts = scran::log_normalize_counts::compute(counts, size_factors, lopt);</div>
</div><!-- fragment --><p>Check out the <a href="https://libscran.github.io/log_normalize_counts">reference documentation</a> for more details.</p>
<h1>Building projects</h1>
<p>This repository is part of the broader <a href="https://github.com/libscran/libscran"><b>libscran</b></a> library, so users are recommended to use the latter in their projects. <b>libscran</b> developers should just use CMake with <code>FetchContent</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  scran_log_normalize_counts </div>
<div class="line">  GIT_REPOSITORY https://github.com/libscran/log_normalize_counts</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(scran_log_normalize_counts)</div>
<div class="line"> </div>
<div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe scran_log_normalize_counts)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE scran_log_normalize_counts)</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
